name: docsense

services:
  postgres:
    image: postgres:16-alpine
    container_name: docsense-postgres
    restart: unless-stopped
    env_file:
      - ./env/postgres.env.example
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ../postgres/schema.sql:/docker-entrypoint-initdb.d/01_schema.sql:ro

  qdrant:
    image: qdrant/qdrant:v1.12.1
    container_name: docsense-qdrant
    restart: unless-stopped
    env_file:
      - ./env/qdrant.env.example
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant_data:/qdrant/storage

  api:
    build:
      context: ../../services/api
      dockerfile: Dockerfile
    container_name: docsense-api
    restart: unless-stopped
    env_file:
      - ./env/api.env.example
    ports:
      - "8080:8080"
    depends_on:
      - postgres
    volumes:
      - api_data:/data

  rag:
    build:
      context: ../../services/rag
      dockerfile: Dockerfile
    container_name: docsense-rag
    restart: unless-stopped
    env_file:
      - ./env/rag.env.example
    ports:
      - "8000:8000"
    depends_on:
      - qdrant

  web:
    build:
      context: ../../apps/web
      dockerfile: Dockerfile
    container_name: docsense-web
    restart: unless-stopped
    env_file:
      - ./env/web.env.example
    ports:
      - "5173:5173"
    depends_on:
      - api
      - rag

volumes:
  postgres_data:
    name: docsense_postgres_data
  qdrant_data:
    name: docsense_qdrant_data
  api_data:
    name: docsense_api_data
